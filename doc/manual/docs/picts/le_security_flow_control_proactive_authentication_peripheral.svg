<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="807px" preserveAspectRatio="none" style="width:2039px;height:807px;" version="1.1" viewBox="0 0 2039 807" width="2039px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ityx9v430wbn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="401" x="818.25" y="26.708">Proactive Authentication in Peripheral Role</text><ellipse cx="1030.1563" cy="40.9531" fill="#000000" filter="url(#f1ityx9v430wbn)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="166" x="947.1563" y="70.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="142" x="961.1563" y="92.0918">App on B connects to A</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="254" x="903.1563" y="124.9219"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="230" x="917.1563" y="146.0605">App on A triggers GATT Client request</text><polygon fill="#FEFECE" filter="url(#f1ityx9v430wbn)" points="989.1563,178.8906,1071.1563,178.8906,1083.1563,190.8906,1071.1563,202.8906,989.1563,202.8906,977.1563,190.8906,989.1563,178.8906" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="82" x="989.1563" y="194.6987">LTK available?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="963.1563" y="188.2964">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="1083.1563" y="188.2964">yes</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="173" x="295.8125" y="212.8906"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="149" x="309.8125" y="234.0293">GATT Client request sent</text><polygon fill="#FEFECE" filter="url(#f1ityx9v430wbn)" points="213.8125,266.8594,550.8125,266.8594,562.8125,278.8594,550.8125,290.8594,213.8125,290.8594,201.8125,278.8594,213.8125,266.8594" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="337" x="213.8125" y="282.6675">GATT Server returns an ATT_ERROR_INSUFFICIENT_X error?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="187.8125" y="276.2651">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="562.8125" y="276.2651">yes</text><rect fill="#23DB2B" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="11" y="300.8594"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="180" x="25" y="321.998">App receives GATT Response</text><ellipse cx="113" cy="380.8281" fill="#FFFFFF" filter="url(#f1ityx9v430wbn)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="113" cy="380.8281" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#f1ityx9v430wbn)" points="536.625,300.8594,766.625,300.8594,778.625,312.8594,766.625,324.8594,536.625,324.8594,524.625,312.8594,536.625,300.8594" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="230" x="536.625" y="316.6675">ENABLE_GATT_CLIENT_PAIRING defined?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="510.625" y="310.2651">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="778.625" y="310.2651">yes</text><rect fill="#FD5B41" filter="url(#f1ityx9v430wbn)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="291" x="245" y="334.8594"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="267" x="259" y="355.998">App receives GATT_QUERY_COMPLETE event</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="192" x="271" y="369.9668">with ATT_ERROR_INSUFFICIENT_X</text><ellipse cx="390.5" cy="428.7969" fill="#FFFFFF" filter="url(#f1ityx9v430wbn)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="390.5" cy="428.7969" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="194" x="815.75" y="334.8594"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="170" x="829.75" y="355.998">SM_EVENT_PAIRING_STARTED</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="233" x="796.25" y="403.8281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="209" x="810.25" y="424.9668">SM on A sends SECURITY REQUEST</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="279" x="773.25" y="472.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="255" x="787.25" y="493.9355">SM on B should perform pairing sequence</text><polygon fill="#FEFECE" filter="url(#f1ityx9v430wbn)" points="866.25,541.7656,959.25,541.7656,971.25,553.7656,959.25,565.7656,866.25,565.7656,854.25,553.7656,866.25,541.7656" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="93" x="866.25" y="557.5737">pairing success?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="833.25" y="551.1714">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="971.25" y="551.1714">no</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="352" x="566" y="575.7656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="328" x="580" y="596.9043">SM_EVENT_PAIRING_COMPLETE(ERROR_CODE_SUCCESS)</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="191" x="646.5" y="644.7344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="167" x="660.5" y="665.873">GATT Client request re-sent</text><rect fill="#23DB2B" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="640" y="712.6719"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="180" x="654" y="733.8105">App receives GATT Response</text><ellipse cx="742" cy="779.6406" fill="#FFFFFF" filter="url(#f1ityx9v430wbn)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="742" cy="779.6406" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="243" x="962" y="575.7656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="219" x="976" y="596.9043">SM_EVENT_PAIRING_COMPLETE(error)</text><rect fill="#FD5B41" filter="url(#f1ityx9v430wbn)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="291" x="938" y="644.7344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="267" x="952" y="665.873">App receives GATT_QUERY_COMPLETE event</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="192" x="968" y="679.8418">with ATT_ERROR_INSUFFICIENT_X</text><ellipse cx="1083.5" cy="737.6406" fill="#FFFFFF" filter="url(#f1ityx9v430wbn)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="1083.5" cy="737.6406" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="235" x="1510.5" y="212.8906"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="211" x="1524.5" y="234.0293">SM_EVENT_REENCRYPTION_STARTED</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="233" x="1511.5" y="266.8594"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="209" x="1525.5" y="287.998">SM on A sends SECURITY REQUEST</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="330" x="1463" y="335.8281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="306" x="1477" y="356.9668">SM on B should encrypt connection if LTK available</text><polygon fill="#FEFECE" filter="url(#f1ityx9v430wbn)" points="1591,404.7969,1665,404.7969,1677,416.7969,1665,428.7969,1591,428.7969,1579,416.7969,1591,404.7969" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="1591" y="420.605">re-encrypted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="1558" y="414.2026">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="1677" y="414.2026">no</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="393" x="1239" y="438.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="369" x="1253" y="459.9355">SM_EVENT_REENCRYPTION_COMPLETE(ERROR_CODE_SUCCESS)</text><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="173" x="1349" y="507.7656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="149" x="1363" y="528.9043">GATT Client request sent</text><rect fill="#23DB2B" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="1333.5" y="576.7344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="180" x="1347.5" y="597.873">App receives GATT Response</text><ellipse cx="1435.5" cy="656.7031" fill="#FFFFFF" filter="url(#f1ityx9v430wbn)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="1435.5" cy="656.7031" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1ityx9v430wbn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="284" x="1678.5" y="438.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="260" x="1692.5" y="459.9355">SM_EVENT_REENCRYPTION_COMPLETE(error)</text><rect fill="#FD5B41" filter="url(#f1ityx9v430wbn)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="337" x="1652" y="507.7656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="267" x="1666" y="528.9043">App receives GATT_QUERY_COMPLETE event</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="297" x="1682" y="542.873">with ATT_ERROR_BONDING_INFORMATION_MISSING</text><path d="M1851.5,590.7031 L1851.5,614.4023 L1831.5,618.4023 L1851.5,622.4023 L1851.5,646.1016 A0,0 0 0 0 1851.5,646.1016 L2027.5,646.1016 A0,0 0 0 0 2027.5,646.1016 L2027.5,600.7031 L2017.5,590.7031 L1851.5,590.7031 A0,0 0 0 0 1851.5,590.7031 " fill="#FBFB77" filter="url(#f1ityx9v430wbn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2017.5,590.7031 L2017.5,600.7031 L2027.5,600.7031 L2017.5,590.7031 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1857.5" y="607.77">App can delete bonding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="1857.5" y="622.9028">information and repeat</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="1857.5" y="638.0356">the GATT Client request</text><ellipse cx="1820.5" cy="618.4023" fill="#FFFFFF" filter="url(#f1ityx9v430wbn)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="1820.5" cy="618.4023" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1030.1563" x2="1030.1563" y1="50.9531" y2="70.9531"/><polygon fill="#A80036" points="1026.1563,60.9531,1030.1563,70.9531,1034.1563,60.9531,1030.1563,64.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1030.1563" x2="1030.1563" y1="104.9219" y2="124.9219"/><polygon fill="#A80036" points="1026.1563,114.9219,1030.1563,124.9219,1034.1563,114.9219,1030.1563,118.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="113" x2="113" y1="334.8281" y2="369.8281"/><polygon fill="#A80036" points="109,359.8281,113,369.8281,117,359.8281,113,363.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="390.5" x2="390.5" y1="382.7969" y2="417.7969"/><polygon fill="#A80036" points="386.5,407.7969,390.5,417.7969,394.5,407.7969,390.5,411.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="912.75" x2="912.75" y1="368.8281" y2="403.8281"/><polygon fill="#A80036" points="908.75,393.8281,912.75,403.8281,916.75,393.8281,912.75,397.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="912.75" x2="912.75" y1="437.7969" y2="472.7969"/><polygon fill="#A80036" points="908.75,462.7969,912.75,472.7969,916.75,462.7969,912.75,466.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="742" x2="742" y1="609.7344" y2="644.7344"/><polygon fill="#A80036" points="738,634.7344,742,644.7344,746,634.7344,742,638.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="742" x2="742" y1="678.7031" y2="712.6719"/><polygon fill="#A80036" points="738,702.6719,742,712.6719,746,702.6719,742,706.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="742" x2="742" y1="746.6406" y2="768.6406"/><polygon fill="#A80036" points="738,758.6406,742,768.6406,746,758.6406,742,762.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1083.5" x2="1083.5" y1="609.7344" y2="644.7344"/><polygon fill="#A80036" points="1079.5,634.7344,1083.5,644.7344,1087.5,634.7344,1083.5,638.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1083.5" x2="1083.5" y1="692.6719" y2="726.6406"/><polygon fill="#A80036" points="1079.5,716.6406,1083.5,726.6406,1087.5,716.6406,1083.5,720.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="854.25" x2="742" y1="553.7656" y2="553.7656"/><line style="stroke:#A80036;stroke-width:1.5;" x1="742" x2="742" y1="553.7656" y2="575.7656"/><polygon fill="#A80036" points="738,565.7656,742,575.7656,746,565.7656,742,569.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="971.25" x2="1083.5" y1="553.7656" y2="553.7656"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1083.5" x2="1083.5" y1="553.7656" y2="575.7656"/><polygon fill="#A80036" points="1079.5,565.7656,1083.5,575.7656,1087.5,565.7656,1083.5,569.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="912.75" x2="912.75" y1="506.7656" y2="541.7656"/><polygon fill="#A80036" points="908.75,531.7656,912.75,541.7656,916.75,531.7656,912.75,535.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="524.625" x2="390.5" y1="312.8594" y2="312.8594"/><line style="stroke:#A80036;stroke-width:1.5;" x1="390.5" x2="390.5" y1="312.8594" y2="334.8594"/><polygon fill="#A80036" points="386.5,324.8594,390.5,334.8594,394.5,324.8594,390.5,328.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="778.625" x2="912.75" y1="312.8594" y2="312.8594"/><line style="stroke:#A80036;stroke-width:1.5;" x1="912.75" x2="912.75" y1="312.8594" y2="334.8594"/><polygon fill="#A80036" points="908.75,324.8594,912.75,334.8594,916.75,324.8594,912.75,328.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="201.8125" x2="113" y1="278.8594" y2="278.8594"/><line style="stroke:#A80036;stroke-width:1.5;" x1="113" x2="113" y1="278.8594" y2="300.8594"/><polygon fill="#A80036" points="109,290.8594,113,300.8594,117,290.8594,113,294.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="562.8125" x2="651.625" y1="278.8594" y2="278.8594"/><line style="stroke:#A80036;stroke-width:1.5;" x1="651.625" x2="651.625" y1="278.8594" y2="300.8594"/><polygon fill="#A80036" points="647.625,290.8594,651.625,300.8594,655.625,290.8594,651.625,294.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="382.3125" x2="382.3125" y1="246.8594" y2="266.8594"/><polygon fill="#A80036" points="378.3125,256.8594,382.3125,266.8594,386.3125,256.8594,382.3125,260.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1628" x2="1628" y1="246.8594" y2="266.8594"/><polygon fill="#A80036" points="1624,256.8594,1628,266.8594,1632,256.8594,1628,260.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1628" x2="1628" y1="300.8281" y2="335.8281"/><polygon fill="#A80036" points="1624,325.8281,1628,335.8281,1632,325.8281,1628,329.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1435.5" x2="1435.5" y1="472.7656" y2="507.7656"/><polygon fill="#A80036" points="1431.5,497.7656,1435.5,507.7656,1439.5,497.7656,1435.5,501.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1435.5" x2="1435.5" y1="541.7344" y2="576.7344"/><polygon fill="#A80036" points="1431.5,566.7344,1435.5,576.7344,1439.5,566.7344,1435.5,570.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1435.5" x2="1435.5" y1="610.7031" y2="645.7031"/><polygon fill="#A80036" points="1431.5,635.7031,1435.5,645.7031,1439.5,635.7031,1435.5,639.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1820.5" x2="1820.5" y1="472.7656" y2="507.7656"/><polygon fill="#A80036" points="1816.5,497.7656,1820.5,507.7656,1824.5,497.7656,1820.5,501.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1820.5" x2="1820.5" y1="555.7031" y2="607.4023"/><polygon fill="#A80036" points="1816.5,597.4023,1820.5,607.4023,1824.5,597.4023,1820.5,601.4023" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1579" x2="1435.5" y1="416.7969" y2="416.7969"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1435.5" x2="1435.5" y1="416.7969" y2="438.7969"/><polygon fill="#A80036" points="1431.5,428.7969,1435.5,438.7969,1439.5,428.7969,1435.5,432.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1677" x2="1820.5" y1="416.7969" y2="416.7969"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1820.5" x2="1820.5" y1="416.7969" y2="438.7969"/><polygon fill="#A80036" points="1816.5,428.7969,1820.5,438.7969,1824.5,428.7969,1820.5,432.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1628" x2="1628" y1="369.7969" y2="404.7969"/><polygon fill="#A80036" points="1624,394.7969,1628,404.7969,1632,394.7969,1628,398.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="977.1563" x2="382.3125" y1="190.8906" y2="190.8906"/><line style="stroke:#A80036;stroke-width:1.5;" x1="382.3125" x2="382.3125" y1="190.8906" y2="212.8906"/><polygon fill="#A80036" points="378.3125,202.8906,382.3125,212.8906,386.3125,202.8906,382.3125,206.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1083.1563" x2="1628" y1="190.8906" y2="190.8906"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1628" x2="1628" y1="190.8906" y2="212.8906"/><polygon fill="#A80036" points="1624,202.8906,1628,212.8906,1632,202.8906,1628,206.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1030.1563" x2="1030.1563" y1="158.8906" y2="178.8906"/><polygon fill="#A80036" points="1026.1563,168.8906,1030.1563,178.8906,1034.1563,168.8906,1030.1563,172.8906" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[b14d4dadaec62ab880e685d98454de5a]
@startuml
title Proactive Authentication in Peripheral Role
start
: App on B connects to A;
: App on A triggers GATT Client request;
if (LTK available?) then (no)
  : GATT Client request sent;
  if (GATT Server returns an ATT_ERROR_INSUFFICIENT_X error?) then (no)
    #23DB2B : App receives GATT Response;
    stop
  else (yes)
    if (ENABLE_GATT_CLIENT_PAIRING defined?) then (no)
      #FD5B41: App receives GATT_QUERY_COMPLETE event
          with ATT_ERROR_INSUFFICIENT_X;
      stop
    else (yes)
      : SM_EVENT_PAIRING_STARTED;
      : SM on A sends SECURITY REQUEST;
      : SM on B should perform pairing sequence;
      if (pairing success?) then (yes)
          : SM_EVENT_PAIRING_COMPLETE(ERROR_CODE_SUCCESS);
          : GATT Client request re-sent;
          #23DB2B : App receives GATT Response;
          stop
      else (no)
          : SM_EVENT_PAIRING_COMPLETE(error);
         #FD5B41: App receives GATT_QUERY_COMPLETE event 
              with ATT_ERROR_INSUFFICIENT_X;
          stop
      endif
    endif
  endif
else (yes)
   : SM_EVENT_REENCRYPTION_STARTED;
   : SM on A sends SECURITY REQUEST;
   : SM on B should encrypt connection if LTK available;
   if (re-encrypted) then (yes)
     : SM_EVENT_REENCRYPTION_COMPLETE(ERROR_CODE_SUCCESS);
     : GATT Client request sent;
     #23DB2B : App receives GATT Response;
     stop
   else (no)
     : SM_EVENT_REENCRYPTION_COMPLETE(error);
     #FD5B41: App receives GATT_QUERY_COMPLETE event 
          with ATT_ERROR_BONDING_INFORMATION_MISSING;
     stop
     note right
       App can delete bonding 
       information and repeat 
       the GATT Client request
    end note
  endif
endif
@enduml

PlantUML version 1.2020.22beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>