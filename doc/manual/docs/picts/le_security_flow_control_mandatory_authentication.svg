<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="531px" preserveAspectRatio="none" style="width:1484px;height:531px;" version="1.1" viewBox="0 0 1484 531" width="1484px" zoomAndPan="magnify"><defs><filter height="300%" id="f18j8gjiqjx3qy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="243" x="619.5" y="26.708">Mandatory Authentication</text><ellipse cx="600.6875" cy="40.9531" fill="#000000" filter="url(#f18j8gjiqjx3qy)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="385" x="408.1875" y="70.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="361" x="422.1875" y="92.0918">App calls gatt_client_set_required_security_level (level &gt; 0)</text><rect fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="541.1875" y="124.9219"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="95" x="555.1875" y="146.0605">A connects to B</text><rect fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="254" x="473.6875" y="178.8906"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="230" x="487.6875" y="200.0293">App triggers GATT Client request on A</text><polygon fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" points="562.6875,232.8594,638.6875,232.8594,650.6875,244.8594,638.6875,256.8594,562.6875,256.8594,550.6875,244.8594,562.6875,232.8594" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="76" x="562.6875" y="248.6675">LTK available</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="529.6875" y="242.2651">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="650.6875" y="242.2651">no</text><rect fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="198.75" y="266.8594"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="95" x="212.75" y="287.998">start encryption</text><polygon fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" points="221.25,320.8281,295.25,320.8281,307.25,332.8281,295.25,344.8281,221.25,344.8281,209.25,332.8281,221.25,320.8281" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="221.25" y="336.6362">re-encrypted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="188.25" y="330.2339">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="307.25" y="330.2339">no</text><rect fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="173" x="26.5" y="354.8281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="149" x="40.5" y="375.9668">GATT Client request sent</text><rect fill="#23DB2B" filter="url(#f18j8gjiqjx3qy)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="11" y="423.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="180" x="25" y="444.9355">App receives GATT Response</text><ellipse cx="113" cy="503.7656" fill="#FFFFFF" filter="url(#f18j8gjiqjx3qy)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="113" cy="503.7656" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><rect fill="#FD5B41" filter="url(#f18j8gjiqjx3qy)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="337" x="235" y="354.8281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="267" x="249" y="375.9668">App receives GATT_QUERY_COMPLETE event</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="297" x="265" y="389.9355">with ATT_ERROR_BONDING_INFORMATION_MISSING</text><ellipse cx="403.5" cy="448.7656" fill="#FFFFFF" filter="url(#f18j8gjiqjx3qy)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="403.5" cy="448.7656" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="875.125" y="266.8594"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="889.125" y="287.998">start pairing</text><polygon fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" points="905.125,320.8281,941.125,320.8281,953.125,332.8281,941.125,344.8281,905.125,344.8281,893.125,332.8281,905.125,320.8281" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="905.125" y="336.6362">paired</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="872.125" y="330.2339">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="953.125" y="330.2339">no</text><rect fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="173" x="627.5" y="354.8281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="149" x="641.5" y="375.9668">GATT Client request sent</text><rect fill="#23DB2B" filter="url(#f18j8gjiqjx3qy)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="612" y="423.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="180" x="626" y="444.9355">App receives GATT Response</text><ellipse cx="714" cy="503.7656" fill="#FFFFFF" filter="url(#f18j8gjiqjx3qy)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="714" cy="503.7656" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><polygon fill="#FEFECE" filter="url(#f18j8gjiqjx3qy)" points="1121.25,354.8281,1183.25,354.8281,1195.25,366.8281,1183.25,378.8281,1121.25,378.8281,1109.25,366.8281,1121.25,354.8281" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="62" x="1121.25" y="370.6362">level &gt;= 3</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="1088.25" y="364.2339">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="1195.25" y="364.2339">no</text><rect fill="#FD5B41" filter="url(#f18j8gjiqjx3qy)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="322" x="826" y="388.8281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="267" x="840" y="409.9668">App receives GATT_QUERY_COMPLETE event</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="286" x="852" y="423.9355">with ATT_ERROR_INSUFFICIENT_AUTHENTICATION</text><ellipse cx="987" cy="482.7656" fill="#FFFFFF" filter="url(#f18j8gjiqjx3qy)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="987" cy="482.7656" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><rect fill="#FD5B41" filter="url(#f18j8gjiqjx3qy)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="299" x="1168" y="388.8281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="267" x="1182" y="409.9668">App receives GATT_QUERY_COMPLETE event</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="259" x="1194" y="423.9355">with ATT_ERROR_INSUFFICIENT_ENCRYPTION;</text><ellipse cx="1317.5" cy="482.7656" fill="#FFFFFF" filter="url(#f18j8gjiqjx3qy)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="1317.5" cy="482.7656" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="600.6875" x2="600.6875" y1="50.9531" y2="70.9531"/><polygon fill="#A80036" points="596.6875,60.9531,600.6875,70.9531,604.6875,60.9531,600.6875,64.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="600.6875" x2="600.6875" y1="104.9219" y2="124.9219"/><polygon fill="#A80036" points="596.6875,114.9219,600.6875,124.9219,604.6875,114.9219,600.6875,118.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="600.6875" x2="600.6875" y1="158.8906" y2="178.8906"/><polygon fill="#A80036" points="596.6875,168.8906,600.6875,178.8906,604.6875,168.8906,600.6875,172.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="113" x2="113" y1="388.7969" y2="423.7969"/><polygon fill="#A80036" points="109,413.7969,113,423.7969,117,413.7969,113,417.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="113" x2="113" y1="457.7656" y2="492.7656"/><polygon fill="#A80036" points="109,482.7656,113,492.7656,117,482.7656,113,486.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="403.5" x2="403.5" y1="402.7656" y2="437.7656"/><polygon fill="#A80036" points="399.5,427.7656,403.5,437.7656,407.5,427.7656,403.5,431.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="209.25" x2="113" y1="332.8281" y2="332.8281"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="113" x2="113" y1="332.8281" y2="354.8281"/><polygon fill="#A80036" points="109,344.8281,113,354.8281,117,344.8281,113,348.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="307.25" x2="403.5" y1="332.8281" y2="332.8281"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="403.5" x2="403.5" y1="332.8281" y2="354.8281"/><polygon fill="#A80036" points="399.5,344.8281,403.5,354.8281,407.5,344.8281,403.5,348.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258.25" x2="258.25" y1="300.8281" y2="320.8281"/><polygon fill="#A80036" points="254.25,310.8281,258.25,320.8281,262.25,310.8281,258.25,314.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="714" x2="714" y1="388.7969" y2="423.7969"/><polygon fill="#A80036" points="710,413.7969,714,423.7969,718,413.7969,714,417.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="714" x2="714" y1="457.7656" y2="492.7656"/><polygon fill="#A80036" points="710,482.7656,714,492.7656,718,482.7656,714,486.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="987" x2="987" y1="436.7656" y2="471.7656"/><polygon fill="#A80036" points="983,461.7656,987,471.7656,991,461.7656,987,465.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1317.5" x2="1317.5" y1="436.7656" y2="471.7656"/><polygon fill="#A80036" points="1313.5,461.7656,1317.5,471.7656,1321.5,461.7656,1317.5,465.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1109.25" x2="987" y1="366.8281" y2="366.8281"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="987" x2="987" y1="366.8281" y2="388.8281"/><polygon fill="#A80036" points="983,378.8281,987,388.8281,991,378.8281,987,382.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1195.25" x2="1317.5" y1="366.8281" y2="366.8281"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1317.5" x2="1317.5" y1="366.8281" y2="388.8281"/><polygon fill="#A80036" points="1313.5,378.8281,1317.5,388.8281,1321.5,378.8281,1317.5,382.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="893.125" x2="714" y1="332.8281" y2="332.8281"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="714" x2="714" y1="332.8281" y2="354.8281"/><polygon fill="#A80036" points="710,344.8281,714,354.8281,718,344.8281,714,348.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="953.125" x2="1152.25" y1="332.8281" y2="332.8281"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1152.25" x2="1152.25" y1="332.8281" y2="354.8281"/><polygon fill="#A80036" points="1148.25,344.8281,1152.25,354.8281,1156.25,344.8281,1152.25,348.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="923.125" x2="923.125" y1="300.8281" y2="320.8281"/><polygon fill="#A80036" points="919.125,310.8281,923.125,320.8281,927.125,310.8281,923.125,314.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="550.6875" x2="258.25" y1="244.8594" y2="244.8594"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258.25" x2="258.25" y1="244.8594" y2="266.8594"/><polygon fill="#A80036" points="254.25,256.8594,258.25,266.8594,262.25,256.8594,258.25,260.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="650.6875" x2="923.125" y1="244.8594" y2="244.8594"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="923.125" x2="923.125" y1="244.8594" y2="266.8594"/><polygon fill="#A80036" points="919.125,256.8594,923.125,266.8594,927.125,256.8594,923.125,260.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="600.6875" x2="600.6875" y1="212.8594" y2="232.8594"/><polygon fill="#A80036" points="596.6875,222.8594,600.6875,232.8594,604.6875,222.8594,600.6875,226.8594" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[8855ab523bc20e0091180bd769a52ee2]
@startuml
title Mandatory Authentication
start
: App calls gatt_client_set_required_security_level (level > 0);
: A connects to B;
: App triggers GATT Client request on A;

if (LTK available) then (yes)
   : start encryption;
   if (re-encrypted) then (yes)
     : GATT Client request sent;
     #23DB2B : App receives GATT Response;
     stop
  else (no)
     #FD5B41: App receives GATT_QUERY_COMPLETE event 
          with ATT_ERROR_BONDING_INFORMATION_MISSING;
     stop
  endif 

else (no)
   : start pairing;

  if (paired) then (yes)
     : GATT Client request sent;
     #23DB2B : App receives GATT Response;
     stop
  else (no)
    if (level >= 3) then (yes)
      #FD5B41: App receives GATT_QUERY_COMPLETE event
          with ATT_ERROR_INSUFFICIENT_AUTHENTICATION;
      stop
    else (no)
      #FD5B41: App receives GATT_QUERY_COMPLETE event 
          with ATT_ERROR_INSUFFICIENT_ENCRYPTION;  
      stop
    endif     
  endif
@enduml

PlantUML version 1.2020.20(Sat Nov 21 10:02:45 UTC 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>